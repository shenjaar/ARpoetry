"use strict";var renderer,scene,camera,arToolkitSource,arToolkitContext,markerRoot1Anim={_customposition:[.72,8.32,0],_customscale:14,_customrotation:[-.24,1.57,0]},markerRoot2Anim={_customposition:[1.18,6.02,-1.48],_customscale:16,_customrotation:[-.59,.06,-.44]},markerRoot3Anim={_customposition:[-3.48,2.76,-.04],_customscale:12,_customrotation:[0,3.14,0]},markerRoot4Anim={_customposition:[-1.4,1.18,-3.4],_customscale:12,_customrotation:[1.66,-5.28,3.86]},markerRoot1,markerRoot2,markerRoot3,markerRoot4,params={lineColor:"#000",lineWidth:5,fps:10,planeSize:1.25},camera,scene,renderer,stats,currentTime,previousTime,geometry,testBoxMaterial,cube,normanMaterials={},normanSceneHelper={};function init(){function r(){arToolkitSource.onResize(),arToolkitSource.copySizeTo(renderer.domElement),null!==arToolkitContext.arController&&arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)}(renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0})).setClearColor(new THREE.Color("lightgrey"),0),renderer.setSize(window.innerWidth,window.innerHeight),renderer.domElement.style.position="absolute",renderer.domElement.style.top="0px",renderer.domElement.style.left="0px",document.body.appendChild(renderer.domElement),scene=new THREE.Scene,camera=new THREE.Camera,scene.add(camera),(arToolkitSource=new THREEx.ArToolkitSource({sourceType:"webcam"})).init(function e(){r()}),window.addEventListener("resize",function(){r()}),(arToolkitContext=new THREEx.ArToolkitContext({cameraParametersUrl:THREEx.ArToolkitContext.baseURL+"../data/camera_para.dat",detectionMode:"mono",patternRatio:.8})).init(function e(){camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix())}),(markerRoot1=new THREE.Group).name="marker1",scene.add(markerRoot1);var e=new THREEx.ArMarkerControls(arToolkitContext,markerRoot1,{type:"pattern",patternUrl:THREEx.ArToolkitContext.baseURL+"../patterns/pattern-marker1.patt"});addPlane(markerRoot1),(markerRoot2=new THREE.Group).name="marker2",scene.add(markerRoot2);var e=new THREEx.ArMarkerControls(arToolkitContext,markerRoot2,{type:"pattern",patternUrl:THREEx.ArToolkitContext.baseURL+"../patterns/pattern-marker2.patt"});addPlane(markerRoot2),(markerRoot3=new THREE.Group).name="marker3",scene.add(markerRoot3);var e=new THREEx.ArMarkerControls(arToolkitContext,markerRoot3,{type:"pattern",patternUrl:THREEx.ArToolkitContext.baseURL+"../patterns/pattern-marker3.patt"});addPlane(markerRoot3),(markerRoot4=new THREE.Group).name="marker4",scene.add(markerRoot4);var e=new THREEx.ArMarkerControls(arToolkitContext,markerRoot4,{type:"pattern",patternUrl:THREEx.ArToolkitContext.baseURL+"../patterns/pattern-marker4.patt"});addPlane(markerRoot4),previousTime=new Date,params.timeBetweenFrames=1e3/params.fps,initNorman(kaur.compData,markerRoot1,markerRoot1Anim),initNorman(bukowski.compData,markerRoot2,markerRoot2Anim),initNorman(july.compData,markerRoot3,markerRoot3Anim),initNorman(kerouac.compData,markerRoot4,markerRoot4Anim)}function addPlane(e){var r=new THREE.PlaneGeometry(params.planeSize,params.planeSize,1),t=new THREE.MeshBasicMaterial({color:"white",side:THREE.DoubleSide}),o=new THREE.Mesh(r,t);o.rotateX(THREE.Math.degToRad(90)),e.add(o)}function addObjects(){var e=new THREE.PlaneGeometry(params.planeSize,params.planeSize,1),r=new THREE.MeshBasicMaterial({color:"white",side:THREE.DoubleSide}),t=new THREE.Mesh(e,r);t.rotateX(THREE.Math.degToRad(90)),scene.add(t)}function updateARToolkit(){!1!==arToolkitSource.ready&&(arToolkitContext.update(arToolkitSource.domElement),scene.visible=camera.visible)}function animate(){requestAnimationFrame(animate),markerRoot1.visible&&tickAnimation(markerRoot1Anim),markerRoot2.visible&&tickAnimation(markerRoot2Anim),markerRoot3.visible&&tickAnimation(markerRoot3Anim),markerRoot4.visible&&tickAnimation(markerRoot4Anim),updateARToolkit(),renderer.render(scene,camera)}function initNorman(e,r,m){m.previousTime=new Date,m.frameIndex=0,m.container=new THREE.Group,m.innerContainer=new THREE.Group,m.container.add(m.innerContainer);var s=getMaterial(params.lineColor);m.clips=e.map(function(e){return e.map(function(e,r){var t=new THREE.BufferGeometry,o=[],a=[],n=0;e.forEach(function(e){if(e.length){var r=e[0];o.push(r.x,r.y,r.z),n++,e.forEach(function(e){o.push(e.x,e.y,e.z),a.push(n-1,n),n++})}}),t.setIndex(new THREE.BufferAttribute(new Uint16Array(a),1)),t.addAttribute("position",new THREE.BufferAttribute(new Float32Array(o),3)),t.attributes.position.needsUpdate=!0;var i=new THREE.LineSegments(t,s);return i.visible=0===r,m.innerContainer.add(i),i})}),m.frameIndices=new Array(m.clips.length).fill(0),m.frameLimits=m.clips.map(function(e){return e.length-1}),m.container.position.x=m._customposition[0],m.container.position.y=m._customposition[1],m.container.position.z=m._customposition[2],m.container.rotation.x=m._customrotation[0],m.container.rotation.y=m._customrotation[1],m.container.rotation.z=m._customrotation[2];var t=m._customscale;m.container.scale.set(t,t,t),m.container.name="Animation",r.add(m.container)}function getMaterial(e){var r=e instanceof THREE.Color?"#"+e.getHexString():e;return normanMaterials[r]||(normanMaterials[r]=new THREE.LineBasicMaterial({color:e,linewidth:0})),normanMaterials[r]}function tickAnimation(i){var e;n=1,i.currentTime=new Date,i.currentTime-i.previousTime>=params.timeBetweenFrames&&(i.previousTime=new Date,i.clips.forEach(function(e,r){var t=i.frameIndices[r],o=i.frameLimits[r],a=t+n;a=o<a?0:a<0?o:a,e[t].visible=!1,e[a].visible=!0,i.frameIndices[r]=a}))}init(),animate();